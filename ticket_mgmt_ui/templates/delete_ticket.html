{% extends "base.html" %}
{% load i18n %}

{% block content %}

<div class="col-md-6 mb-3">
    <div class="card">
        <div class="card-body ticketForm">
            <h5 class="mb-4 mt-3 font-weight-bold text-center">Delete Ticket - {{ticket.number}}</h5>
            <hr>

            <div class="table-responsive">
                <table class="table ">
                    <tr>
                        <td>Ticket Number</td>
                        <td>{{ ticket.number }}</td>
                    </tr>
                    <tr>
                        <td>Description</td>
                        <td>{{ ticket.description }}</td>
                    </tr>
                    <tr>
                        <td>Created At</td>
                        <td>{{ ticket.created_at }}</td>
                    </tr>
                    <tr>
                        <td>Resolution End Date</td>
                        <td>{{ ticket.resolution_end_date_formatted }}</td>
                    </tr>
                    <tr>
                        <td>Assigned To</td>
                        <td>{{ ticket.assigned_to }}</td>
                    </tr>
                    <tr>
                        <td>Status</td>
                        <td>{{ ticket.status }}</td>
                    </tr>
                </table>
            </div>

            <form action="{% url 'ticket:delete' ticket.id %}" method="POST">
                {% csrf_token %}
                <div class="d-flex align-items-center justify-content-end" style="padding: 10px;">
                    <button id="delete-ticket-btn" data-ticket-id="{{ ticket.id }}" class="btn btn-primary btn-md mb-1 mt-1" style="font-weight:bold" type="submit">Delete</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
    $(document).ready(function() {
        $('#delete-ticket-btn').click(function(event) {
          event.preventDefault();  // Prevent the default form submission
    
          // Confirm the delete action
          if (confirm("Are you sure you want to delete this ticket?")) {
            var ticketId = $(this).data('ticket-id');
    
            // Send the DELETE request using AJAX
            $.ajax({
              url: '/ticket/' + ticketId + '/delete/',
              type: 'DELETE',
              success: function(response) {
                window.location.href = '/tickets/';
              },
              error: function(response) {
                console.log('Error:', response.responseText);
              }
            });
          }
        });
      });
  </script>
{% endblock %}
  
  