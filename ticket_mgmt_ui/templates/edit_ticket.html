{% extends "base.html" %}

{% block content %}

    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-body ticketForm">
                <h5 class="mb-3 font-weight-bold text-center">Edit Ticket - {{ticket.number}}</h5>            

                <form id="edit-ticket-form" method="POST" action="{% url 'ticket:edit' ticket.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="_method" value="PUT">
                    <div style="padding: 10px;">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="4"  cols="50"  required>{{ticket.description}}</textarea>
                    </div>
                    <div style="padding: 10px;">
                        <label for="resolution-end-date">Resolution End Date</label>
                        <input class="form-control" type="date" placeholder="dd-mm-yyyy" value={{ticket.resolution_end_date}} id="resolution-end-date" name="resolution_end_date" required>
                    </div>
                    <div style="padding: 10px;">
                        <label for="status">Status</label>
                        <select id="status" name="status" required value={{ticket.status}} selectedOption={{ticket.status}}>
                            <option value="Pending" {% if ticket.status == 'Pending' %}selected{% endif %}>Pending</option>
                            <option value="In Progress" {% if ticket.status == 'In Progress' %}selected{% endif %}>In Progress</option>
                            <option value="Completed" {% if ticket.status == 'Completed' %}selected{% endif %}>Completed</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center justify-content-end" style="padding: 10px;">
                    <button class="btn btn-primary btn-md mb-1 mt-1" data-ticket-id="{{ ticket.id }}" style="font-weight:bold" type="submit" id="edit-ticket-btn">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        $(document).ready(function() {
            $('#edit-ticket-btn').click(function(event) {
                event.preventDefault();  // Prevent the default form submission
          
                var ticketId = $(this).data('ticket-id');
        
                // Send the EDIT request using AJAX
                $.ajax({
                   url: '/ticket/' + ticketId + '/update/',
                    type: "PUT",
                    data: {
                        'description': $('#description').val(),
                        'resolution_end_date': $('#resolution-end-date').val(),
                        'status': $('#status').val(),
                    },
                    success: function(response) {
                        window.location.href = '/tickets/';
                    },
                    error: function(response) {
                        console.log('Error:', response.responseText);
                    }
                });
            });
        });
    </script>
{% endblock %}
